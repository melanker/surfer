var SurfInfo=function(){};SurfInfo.prototype.getTime=function(a){var t=function(a){return 10>a&&(a="0"+a),a},e=new Date(a),d=t(e.getHours()),i=t(e.getMinutes());return d+":"+i},SurfInfo.prototype.prettyDate=function(a){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=new Date(a);return t[e.getUTCMonth()]+" "+e.getUTCDate()},SurfInfo.prototype.reqFlag=!0,SurfInfo.prototype.initCity=function(){var a,t,e=this,d={},i=$(".loading");a=function(){var a=$(".weatherCurrent");a.find(".cloudsImg").css("background","url(/styles/img/"+d.weather[0].icon+".png) no-repeat"),a.find(".temp").html(d.main.temp.toPrecision(4)+"&deg"),d.windSpeedKnots=(1.94384*d.wind.speed).toPrecision(4),"Haifa"===e.data.locationPath||"Nahariya"===e.data.locationPath?(d.waveHeight=e.data.charts.haifaData.dataHs[e.data.charts.haifaData.dataHs.length-1],a.find(".seaTemp").html(parseFloat(e.data.charts.haifaData.data[e.data.charts.haifaData.data.length-1].temp)+"&deg")):"Ashdod"===e.data.locationPath?(d.waveHeight=e.data.charts.ashdodData.dataHs[e.data.charts.ashdodData.dataHs.length-1],a.find(".seaTemp").html(parseFloat(e.data.charts.ashdodData.data[e.data.charts.ashdodData.data.length-1].temp)+"&deg")):(d.waveHeight=((e.data.charts.ashdodData.dataHs[e.data.charts.ashdodData.dataHs.length-1]+e.data.charts.haifaData.dataHs[e.data.charts.haifaData.dataHs.length-1])/2).toPrecision(3),a.find(".seaTemp").html(((parseFloat(e.data.charts.ashdodData.data[e.data.charts.ashdodData.data.length-1].temp)+parseFloat(e.data.charts.haifaData.data[e.data.charts.haifaData.data.length-1].temp))/2).toPrecision(4)+"&deg")),a.find(".waves").text(d.waveHeight+"m"),a.find(".speed").text((1.94384*d.wind.speed).toPrecision(4)+" קשר"),a.find(".direction").css({background:"url(/styles/img/wa-sprite.png) -50px -1040px no-repeat","-webkit-transform":"rotate("+d.wind.deg+"deg)","-moz-transform":"rotate("+d.wind.deg+"deg)","-ms-transform":"rotate("+d.wind.deg+"deg)",transform:"rotate("+d.wind.deg+"deg)"}),a.find(".sunset").text(e.getTime(1e3*d.sys.sunset)),a.find(".sunrise").text(e.getTime(1e3*d.sys.sunrise)),a.find(".lastUpdated").text(e.prettyDate(1e3*d.dt)+" "+e.getTime(1e3*d.dt)),a.show()},t=function(){var a,t,e="",n="",s=$(".details"),r=$("#imgStat");switch(d.wind.deg>=80&&d.wind.deg<=100?(a="מזרחית",n="רוח מזרחית עלולה להשטיח את הגל"):d.wind.deg>100&&d.wind.deg<170?a="דרומית מזרחית":d.wind.deg>=170&&d.wind.deg<=190?(a="דרומית",n="קחו לתשומת ליבכם שרוח דרומית הינה בעלת השפעה קטנה על הגל"):d.wind.deg>190&&d.wind.deg<260?a="מערבית דרומית":d.wind.deg>=260&&d.wind.deg<=280?a="מערבית":d.wind.deg>280&&d.wind.deg<360?a="מערבית צפונית":d.wind.deg>=360||d.wind.deg>=0&&d.wind.deg<=10?(a="צפונית",n="קחו לתשומת ליבכם שרוח צפונית הינה בעלת השפעה קטנה על הגל"):a="צפונית מזרחית",!0){case d.windSpeedKnots<=7:t="רוח חלשה";break;case d.windSpeedKnots>7&&d.windSpeedKnots<10:t="רוח בינונית";break;case d.windSpeedKnots>=10&&d.windSpeedKnots<13:t="רוח בינונית חזקה";break;case d.windSpeedKnots>=13&&d.windSpeedKnots<16:t="רוח חזקה";break;case d.windSpeedKnots>=16:t="רוח חזקה מאוד"}d.waveHeight>=.8?d.windSpeedKnots<=7?(e="ים חלום. קחו חופש מחלה וצאו לים",r.attr("src","/styles/img/perfectWave.jpg")):d.windSpeedKnots>7&&d.windSpeedKnots<10?(e="הים עובד יופי, צריך עדיין להתחשב בכיוון הרוח ועוצמתה",r.attr("src","/styles/img/regWaves.jpg")):d.windSpeedKnots>10&&d.windSpeedKnots<16?(e="ים למנוסים, יש סיכוי לסחף ומכבסות עדיף חופים סגורים",r.attr("src","/styles/img/forPros.jpg")):(e="לא מומלץ לרדת לים",r.attr("src","/styles/img/chppyWaves.jpg")):d.waveHeight<.8&&d.waveHeight>=.5?d.windSpeedKnots<=7?(e="ים מצויין למתחילים עם לונג בורד",r.attr("src","/styles/img/longboardWave.jpg")):d.windSpeedKnots>7&&d.windSpeedKnots<10?(e="ים סביר, למתחילים עם לונג",r.attr("src","/styles/img/longboardWave.jpg")):(e="לא מומלץ, גל נמוך ורוח יחסית חזקה",r.attr("src","/styles/img/lowCrappyWaves.jpg")):(e="ים לחסקה",r.attr("src","/styles/img/hasake.jpg")),s.find("h1").text(e),s.find("p").text(t+" "+a+"\n"+n),i.hide()};var n=function(n){var s=$.Deferred();return e.communication.http(n,"GET").then(function(e){i.show(),e.cod&&"500"===e.cod?s.reject(e):"string"==typeof e&&e.indexOf("city_id")>=0?(d=JSON.parse(JSON.parse(e).data),a(),t(),s.resolve(d)):e.wind?(d=e,a(),t(),s.resolve(d)):s.reject(e)},function(a){s.reject(a)}),s.promise()};n("/server/city_data.php?id="+e.data.cityMapping[e.data.locationPath]).then(function(){},function(){n("http://api.openweathermap.org/data/2.5/weather?id="+e.data.cityMapping[e.data.locationPath]+"&units=metric&APPID=65979c59499d18cff77bbcfd2c8bdce6").then(function(){},function(){e=SurfInfo.prototype,setTimeout(function(){n.call(e,"http://api.openweathermap.org/data/2.5/weather?q="+e.data.locationPath+",il&units=metric&APPID=65979c59499d18cff77bbcfd2c8bdce6").then(function(){},function(){var a=$("#notifyDialog");a.find("p").text("בעיה בשרת, נסה מאוחר יותר"),a.modal("show"),setTimeout(function(){window.location="/"},4e3)})},4e3)})})},SurfInfo.prototype.data={isMobile:!1,requestCounter:0,charts:{ashdodData:{loadingJq:$(".ashdodLoading"),title:"אשדוד",day:"",data:[]},haifaData:{loadingJq:$(".haifaLoading"),title:"חיפה",day:"",data:[]}},cityMapping:{Ashdod:"295629",Herzliyya:"294778","Tel-Aviv":"293397",Netanya:"294071",Haifa:"294801",Nahariya:"294117"},idAndClassesMap:{ashdodChart:"#ashdodChart",haifaChart:"#haifaChart",ashdodStatus:".ashdodStatus",haifaStatus:".haifaStatus",upperNav:".upperNav",openContactMe:".openContactMe"}},SurfInfo.prototype.updateChart=function(a){var t=this,e=t.data.charts[a+"Data"].data.length,d=t.data.charts[a+"Data"].data;t.data.charts[a+"Data"].dataHmax=[],t.data.charts[a+"Data"].dataHs=[],t.data.charts[a+"Data"].dataTime=[];for(var i=1;e>i;i+=1)t.data.charts[a+"Data"].dataHmax.push(d[i].hMax),t.data.charts[a+"Data"].dataHs.push(d[i].hS),t.data.charts[a+"Data"].dataTime.push(d[i].time);$(t.data.idAndClassesMap[a+"Chart"]).highcharts({chart:{type:"areaspline"},title:{text:t.data.charts[a+"Data"].data[0].day+"  "+t.data.charts[a+"Data"].title||t.data.charts[a+"Data"].title,style:{color:"#333",fontSize:"16px",fontWeight:"bold",fontFamily:"almoni-dl-regular, Arial"}},xAxis:{categories:t.data.charts[a+"Data"].dataTime},yAxis:{title:{text:"Height[meter]"}},tooltip:{shared:!0,valueSuffix:" meter"},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:"גל מקסימלי",data:t.data.charts[a+"Data"].dataHmax},{name:"גל ממוצע",data:t.data.charts[a+"Data"].dataHs}]})},SurfInfo.prototype.communication={http:function(a,t,e){var d=$.Deferred();return $.ajax({url:a,crossDomain:!0,type:t,data:e,success:function(a){d.resolve(a)},error:function(a,t,e){d.reject({error:e,status:t})}}),d.promise()}},SurfInfo.prototype.updateWaveInfo=function(){var a,t,e,d,i=this;d=[],a=function(a,t){var e=a.find("td"),d={day:t||"0",time:e.eq(0).text()||"0",hMax:parseFloat(e.eq(1).text())||0,hS:parseFloat(e.eq(2).text())||0,hThird:parseFloat(e.eq(3).text())||"0",direction:e.eq(4).text()||"0",tAv:e.eq(5).text()||"0",tZ:e.eq(6).text()||"0",tP:e.eq(7).text()||"0",temp:e.eq(8).text()||"0"};return d},t=function(t){var e=$.Deferred();return d.push(e.promise()),i.communication.http(t,"GET").then(function(t){var d=[];$.each($(t).find("table").eq(0).find("tr"),function(e,i){d.push(a($(i),$(t).find("[size='+1']").eq(0).text()))}),e.resolve(d)},function(a){e.reject(a)}),e.promise()},e=function(a,t){var e=$(i.data.idAndClassesMap[t+"Status"]+" .height"),d=$(i.data.idAndClassesMap[t+"Status"]+" .date"),n=$(i.data.idAndClassesMap[t+"Status"]+" .hour"),s=$(i.data.idAndClassesMap[t+"Status"]+" .temp");i.data.charts[t+"Data"].data=a,i.updateChart(t),e.text(i.data.charts[t+"Data"].dataHs[i.data.charts[t+"Data"].dataHs.length-1]+"m - "+i.data.charts[t+"Data"].dataHmax[i.data.charts[t+"Data"].dataHmax.length-1]+"m"),d.text(i.data.charts[t+"Data"].data[0].day),n.text(i.data.charts[t+"Data"].dataTime[i.data.charts[t+"Data"].dataTime.length-1]),s.html(i.data.charts[t+"Data"].data[i.data.charts[t+"Data"].data.length-1].temp+"&deg"),$("."+t+"Loading").hide()},t("/server/waves_prox.php?place=ashdod").then(function(a){e(a,"ashdod")}),t("/server/waves_prox.php?place=haifa").then(function(a){e(a,"haifa")}),i.data.locationPath&&$.when.apply($,d).then(function(){i.initCity()})},SurfInfo.prototype.initFunction=function(){var a=this,t=function(){var t,e=$(a.data.idAndClassesMap.upperNav),d=e.find("li"),i=window.location.pathname.replace(/\//g,"");switch(a.data.isMobile=!1,i.indexOf("mobile")>=0&&(a.data.isMobile=!0,i=i.replace("mobile","")),a.data.locationPath=i,e.find(".active").removeClass("active"),e.find(".ui-btn-active").removeClass("ui-btn-active ui-state-persist"),t=function(){a.data.isMobile?this.find("a").addClass("ui-btn-active ui-state-persist"):this.tab("show")},i){case"Netanya":t.call(d.eq(2));break;case"Nahariya":t.call(d.eq(0));break;case"Haifa":t.call(d.eq(1));break;case"Herzliyya":t.call(d.eq(3));break;case"Tel-Aviv":t.call(d.eq(4));break;case"Ashdod":t.call(d.eq(5));break;default:t.call(d.eq(6))}},e=function(){var t=$("#ajax-contact"),e=$("#contactMe");$(t).submit(function(){$(t).serialize();return a.communication.http($(t).attr("action"),"POST",$(t).serialize()).then(function(){},function(){var a=$("#notifyDialog");setTimeout(function(){a.modal("show")},1e3),a.find("p").text("בעיה עם שליחת המייל, יתכן והמייל שהזנת לא תקין. נסה שוב"),setTimeout(function(){a.modal("hide")},8e3)}),e.modal("hide"),e.find("input, textarea").val(""),!1})};e(),t(),a.data.charts.ashdodData.loadingJq.show(),a.data.charts.haifaData.loadingJq.show(),a.updateWaveInfo()},jQuery(function(){var a=new SurfInfo;a.initFunction()});