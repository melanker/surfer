var wavesApp=angular.module("wavesApp",["ngRoute"]);wavesApp.config(["$routeProvider",function(t){t.when("/home",{templateUrl:"/public/app/views/pages/home.html",controller:"HomeCtrl"}).when("/cities/:city",{templateUrl:"/public/app/views/pages/city.html",controller:"CityCtrl"}).otherwise({redirectTo:"/home"})}]),wavesApp.controller("CityCtrl",["$scope","$httpDefer","appConstants","$routeParams","timeFormatter","$q",function(t,e,a,r,i,n){var o,s;t.loadingCity=!0,t.$parent.city=r.city,o=function(){t.weatherIcon={background:"url(/public/assets/img/"+t.currentCity.weather[0].icon+".png)"},t.temp=t.currentCity.main.temp.toPrecision(4),t.windSpeedKnots=(1.94384*t.currentCity.wind.speed).toPrecision(4),"Haifa"===t.city||"Nahariya"===t.city?(t.waveHeight=t.haifa.data.hS[t.haifa.data.hS.length-1],t.seaTemp=parseFloat(t.haifa.data.temperature[t.haifa.data.temperature.length-1])):"Ashdod"===t.city?(t.waveHeight=t.ashdod.data.hS[t.ashdod.data.hS.length-1],t.seaTemp=parseFloat(t.ashdod.data.temperature[t.ashdod.data.temperature.length-1])):(t.waveHeight=((parseFloat(t.ashdod.data.hS[t.ashdod.data.hS.length-1])+parseFloat(t.haifa.data.hS[t.haifa.data.hS.length-1]))/2).toPrecision(3),t.seaTemp=((parseFloat(t.ashdod.data.temperature[t.ashdod.data.temperature.length-1])+parseFloat(t.haifa.data.temperature[t.haifa.data.temperature.length-1]))/2).toPrecision(4)),t.direction={background:"url(/public/assets/img/wa-sprite.png) -50px -1040px no-repeat","-webkit-transform":"rotate("+t.currentCity.wind.deg+"deg)","-moz-transform":"rotate("+t.currentCity.wind.deg+"deg)","-ms-transform":"rotate("+t.currentCity.wind.deg+"deg)",transform:"rotate("+t.currentCity.wind.deg+"deg)"},t.sunset=i.formatTime(1e3*t.currentCity.sys.sunset),t.sunrise=i.formatTime(1e3*t.currentCity.sys.sunrise),t.lastUpdate=i.formatDate(1e3*t.currentCity.dt)+" "+i.formatTime(1e3*t.currentCity.dt)},s=function(){var e,a,r="",i="",n=parseFloat(t.windSpeedKnots),o=parseFloat(t.waveHeight);switch(t.imgBackground={},t.currentCity.wind.deg>=80&&t.currentCity.wind.deg<=100?(e="מזרחית",i="רוח מזרחית עלולה להשטיח את הגל"):t.currentCity.wind.deg>100&&t.currentCity.wind.deg<170?e="דרומית מזרחית":t.currentCity.wind.deg>=170&&t.currentCity.wind.deg<=190?(e="דרומית",i="קחו לתשומת ליבכם שרוח דרומית הינה בעלת השפעה קטנה על הגל"):t.currentCity.wind.deg>190&&t.currentCity.wind.deg<260?e="מערבית דרומית":t.currentCity.wind.deg>=260&&t.currentCity.wind.deg<=280?e="מערבית":t.currentCity.wind.deg>280&&t.currentCity.wind.deg<360?e="מערבית צפונית":t.currentCity.wind.deg>=360||t.currentCity.wind.deg>=0&&t.currentCity.wind.deg<=10?(e="צפונית",i="קחו לתשומת ליבכם שרוח צפונית הינה בעלת השפעה קטנה על הגל"):e="צפונית מזרחית",!0){case 7>=n:a="רוח חלשה";break;case n>7&&10>n:a="רוח בינונית";break;case n>=10&&13>n:a="רוח בינונית חזקה";break;case n>=13&&16>n:a="רוח חזקה";break;case n>=16:a="רוח חזקה מאוד"}o>=.8?7>=n?(r="ים חלום. קחו חופש מחלה וצאו לים",t.imgBackground.src="/public/assets/img/perfectWave.jpg"):n>7&&10>n?(r="הים עובד יופי, צריך עדיין להתחשב בכיוון הרוח ועוצמתה",t.imgBackground.src="/public/assets/img/regWaves.jpg"):n>10&&16>n?(r="ים למנוסים, יש סיכוי לסחף ומכבסות עדיף חופים סגורים",t.imgBackground.src="/public/assets/img/forPros.jpg"):(r="לא מומלץ לרדת לים",t.imgBackground.src="/public/assets/img/chppyWaves.jpg"):.8>o&&o>=.5?7>=n?(r="ים מצויין למתחילים עם לונג בורד",t.imgBackground.src="/public/assets/img/longboardWave.jpg"):n>7&&10>n?(r="ים סביר, למתחילים עם לונג",t.imgBackground.src="/public/assets/img/longboardWave.jpg"):(r="לא מומלץ, גל נמוך ורוח יחסית חזקה",t.imgBackground.src="/public/assets/img/lowCrappyWaves.jpg"):(r="ים לחסקה",t.imgBackground.src="/public/assets/img/hasake.jpg"),t.title=a+" "+e+"\n"+i,t.details=r};var d=function(){o(),s(),t.loadingCity=!1};e.ajax({method:"GET",url:a.CITY_API+t.city}).then(function(e){t.currentCity=e.data,t.ashdod&&t.haifa?d():n.all([t.setup("ashdod"),t.setup("haifa")]).then(function(){d()})},function(t){console.log(t)})}]),wavesApp.controller("HomeCtrl",["$scope",function(t){t.$parent.city=void 0}]),wavesApp.controller("MainCtrl",["$scope","$httpDefer","appConstants","$timeout","$q",function(t,e,a,r,i){var n={ashdod:"ashdod",haifa:"haifa"};t.city=void 0,t.setup=function(o){var s=i.defer();return t[n[o]+"Loading"]=!0,e.ajax({method:"GET",url:a.WAVES_API+o}).then(function(e){r(function(){t[n[o]]={waveRange:"",lastUpdateDate:"",lastUpdateHour:"",seaTemp:""},t[n[o]].data=e.data,$.extend(!0,t[n[o]],{waveRange:e.data.hS[e.data.hS.length-1]+"m-"+e.data.hMax[e.data.hMax.length-1]+"m",lastUpdateDate:e.data.date,lastUpdateHour:e.data.time[e.data.time.length-1],seaTemp:e.data.temperature[e.data.temperature.length-1]}),t[n[o]+"Loading"]=!1,s.resolve()},500)},function(t){console.log(t),s.reject(t)}),s.promise},t.setup(n.ashdod),t.setup(n.haifa)}]),wavesApp.factory("appConstants",function(){return{WAVES_API:"/api/waves/",CITY_API:"/api/"}}),wavesApp.factory("$httpDefer",["$q","$http",function(t,e){var a={};return a.ajax=function(a){var r=t.defer();return e(a).success(function(t){r.resolve(t)}).error(function(t){r.reject(t)}),r.promise},a}]),wavesApp.factory("timeFormatter",function(){return{formatTime:function(t){var e=function(t){return 10>t&&(t="0"+t),t},a=new Date(t),r=e(a.getHours()),i=e(a.getMinutes());return r+":"+i},formatDate:function(t){var e=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],a=new Date(t);return e[a.getUTCMonth()]+" "+a.getUTCDate()}}}),wavesApp.directive("highChart",["$timeout",function(t){return{restrict:"E",scope:{data:"="},template:"<div></div>",link:function(t,e){var a=function(t){var e=[];if(!t||0===t.length)return[];for(var a=0;a<t.length;a+=1)e.push(parseFloat(t[a])||0);return e};t.$watch("data",function(r,i){e.highcharts({chart:{type:"areaspline"},title:{text:(t.$eval("data.date")||"")+",  "+(t.$eval("data.city")?"ASHDOD"===t.$eval("data.city").toUpperCase()?"אשדוד":"חיפה":""),style:{color:"#333",fontSize:"16px",fontWeight:"bold",fontFamily:"almoni-dl-regular, Arial"}},xAxis:{categories:t.$eval("data.time")||[]},yAxis:{title:{text:"Height[meter]"}},tooltip:{shared:!0,valueSuffix:" meter"},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{name:"גל מקסימלי",data:a(t.$eval("data.hMax"))||[]},{name:"גל מינימלי",data:a(t.$eval("data.hS"))||[]}]})})}}}]);