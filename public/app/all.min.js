var webApp={idAndClassesMap:{ashdodChart:"#ashdodChart",haifaChart:"#haifaChart",ashdodStatus:".ashdodStatus",haifaStatus:".haifaStatus"},charts:{ashdodData:{title:"אשדוד",day:"",data:null},haifaData:{title:"חיפה",day:"",data:null}}};$(function(){var a,t,e,d,n,i,s,p,r,o,h,c,l=!1;h=[],c=$(".loading"),o=$(".hiddenTemplate").html(),p=$(document),i=$(".logo"),s=$(".nav"),r={haifaStatusJq:$(".haifaStatus"),ashdodStatusJq:$(".ashdodStatus"),haifaChartJq:$("#haifaChart"),ashdodChartJq:$("#ashdodChart")},e=["Nahariya","Haifa","Netanya","Herzliyya","TelAviv","Ashdod"],r.ashdodStatusJq.hide(),r.haifaChartJq.hide(),r.haifaStatusJq.hide(),r.ashdodChartJq.hide(),a=new ScrollMagic.Controller({globalSceneOptions:{}}),t=function(a){if(!webApp.charts[a+"Data"].data){var t=$.Deferred();h.push(t.promise()),n=new webApp.Main,n.getData("/api/waves/"+a).then(function(e){webApp.charts[a+"Data"].data=e.data,n.setCity(a),d=new webApp.Graph(a),t.resolve(e.data)}),$.when.apply($,h).then(function(){c.hide(),r[a+"StatusJq"].fadeIn(600),r[a+"ChartJq"].fadeIn(600)})}},new ScrollMagic.Scene({triggerElement:"#main",duration:"200%"}).setClassToggle(".main","active").addTo(a).on("enter",function(){t("ashdod"),t("haifa")}),$.each(e,function(t,e){var d=new webApp.City(e),n=5===t?"100%":"120%";$("#"+e).append(o),new ScrollMagic.Scene({triggerElement:"#"+e,duration:n}).setClassToggle("."+e,"active").addTo(a).on("enter",function(){return webApp.charts.ashdodData.data&&webApp.charts.haifaData.data?void(d.dataObj||d.initCity()):void window.scrollTo(0,0)})}),p.scroll(function(){p.scrollTop()>0&&!l&&(l=!0,i.animate({top:"-50px"},400,function(){i.hide()}),s.animate({top:"-50px"},400,function(){s.css({top:"0"})})),0===p.scrollTop()&&l&&(l=!1,s.animate({top:"50px"},400,function(){s.css({top:"0"}),i.show(),i.animate({top:"0"},300,function(){})}))}),a.scrollTo(function(a){TweenMax.to(window,.5,{scrollTo:{y:a}})}),$(document).on("click","a[href^='#']",function(t){var e=$(this).attr("href");$(e).length>0&&(t.preventDefault(),a.scrollTo(e),window.history&&window.history.pushState&&history.pushState("",document.title,e))})}),webApp.City=function(a){this.name=a,this.dataObj=null},webApp.City.prototype.initCity=function(){var a,t,e=this,d=$("#"+e.name+" .weatherCurrent");d.parent().hide(),a=function(){d.find(".lastUpdated").text(webApp.formatDate(1e3*e.dataObj.dt)+" "+webApp.getTime(1e3*e.dataObj.dt)),d.find(".cloudsImg").css("background","url(/public/assets/img/"+e.dataObj.weather[0].icon+".png) no-repeat"),d.find(".temp").html(e.dataObj.main.temp.toPrecision(4)+"&deg"),e.dataObj.windSpeedKnots=(1.94384*e.dataObj.wind.speed).toPrecision(4),"Haifa"===webApp.locationPath||"Nahariya"===webApp.locationPath?(e.dataObj.waveHeight=webApp.charts.haifaData.data.hS[webApp.charts.haifaData.data.hS.length-1],d.find(".seaTemp").html(parseFloat(webApp.charts.haifaData.data.temperature[webApp.charts.haifaData.data.temperature.length-1])+"&deg")):"Ashdod"===webApp.locationPath?(e.dataObj.waveHeight=webApp.charts.ashdodData.data.hS[webApp.charts.ashdodData.data.hS.length-1],d.find(".seaTemp").html(parseFloat(webApp.charts.ashdodData.data.temperature[webApp.charts.ashdodData.data.temperature.length-1])+"&deg")):(e.dataObj.waveHeight=((parseFloat(webApp.charts.ashdodData.data.hS[webApp.charts.ashdodData.data.hS.length-1])+parseFloat(webApp.charts.haifaData.data.hS[webApp.charts.haifaData.data.hS.length-1]))/2).toPrecision(3),d.find(".seaTemp").html(((parseFloat(webApp.charts.ashdodData.data.temperature[webApp.charts.ashdodData.data.temperature.length-1])+parseFloat(webApp.charts.haifaData.data.temperature[webApp.charts.haifaData.data.temperature.length-1]))/2).toPrecision(4)+"&deg")),d.find(".waves").text(e.dataObj.waveHeight+"m"),d.find(".speed").text((1.94384*e.dataObj.wind.speed).toPrecision(4)+" קשר"),d.find(".direction").css({background:"url(/public/assets/img/wa-sprite.png) -50px -1040px no-repeat","-webkit-transform":"rotate("+e.dataObj.wind.deg+"deg)","-moz-transform":"rotate("+e.dataObj.wind.deg+"deg)","-ms-transform":"rotate("+e.dataObj.wind.deg+"deg)",transform:"rotate("+e.dataObj.wind.deg+"deg)"}),d.find(".sunset").text(webApp.getTime(1e3*e.dataObj.sys.sunset)),d.find(".sunrise").text(webApp.getTime(1e3*e.dataObj.sys.sunrise)),d.show()},t=function(){var a,t,n="",i="",s=$(".details"),p=$("#imgStat");switch(e.dataObj.wind.deg>=80&&e.dataObj.wind.deg<=100?(a="מזרחית",i="רוח מזרחית עלולה להשטיח את הגל"):e.dataObj.wind.deg>100&&e.dataObj.wind.deg<170?a="דרומית מזרחית":e.dataObj.wind.deg>=170&&e.dataObj.wind.deg<=190?(a="דרומית",i="קחו לתשומת ליבכם שרוח דרומית הינה בעלת השפעה קטנה על הגל"):e.dataObj.wind.deg>190&&e.dataObj.wind.deg<260?a="מערבית דרומית":e.dataObj.wind.deg>=260&&e.dataObj.wind.deg<=280?a="מערבית":e.dataObj.wind.deg>280&&e.dataObj.wind.deg<360?a="מערבית צפונית":e.dataObj.wind.deg>=360||e.dataObj.wind.deg>=0&&e.dataObj.wind.deg<=10?(a="צפונית",i="קחו לתשומת ליבכם שרוח צפונית הינה בעלת השפעה קטנה על הגל"):a="צפונית מזרחית",!0){case e.dataObj.windSpeedKnots<=7:t="רוח חלשה";break;case e.dataObj.windSpeedKnots>7&&e.dataObj.windSpeedKnots<10:t="רוח בינונית";break;case e.dataObj.windSpeedKnots>=10&&e.dataObj.windSpeedKnots<13:t="רוח בינונית חזקה";break;case e.dataObj.windSpeedKnots>=13&&e.dataObj.windSpeedKnots<16:t="רוח חזקה";break;case e.dataObj.windSpeedKnots>=16:t="רוח חזקה מאוד"}e.dataObj.waveHeight>=.8?e.dataObj.windSpeedKnots<=7?(n="ים חלום. קחו חופש מחלה וצאו לים",p.attr("src","/public/assets/img/perfectWave.jpg")):e.dataObj.windSpeedKnots>7&&e.dataObj.windSpeedKnots<10?(n="הים עובד יופי, צריך עדיין להתחשב בכיוון הרוח ועוצמתה",p.attr("src","/public/assets/img/regWaves.jpg")):e.dataObj.windSpeedKnots>10&&e.dataObj.windSpeedKnots<16?(n="ים למנוסים, יש סיכוי לסחף ומכבסות עדיף חופים סגורים",p.attr("src","/public/assets/img/forPros.jpg")):(n="לא מומלץ לרדת לים",p.attr("src","/public/assets/img/chppyWaves.jpg")):e.dataObj.waveHeight<.8&&e.dataObj.waveHeight>=.5?e.dataObj.windSpeedKnots<=7?(n="ים מצויין למתחילים עם לונג בורד",p.attr("src","/public/assets/img/longboardWave.jpg")):e.dataObj.windSpeedKnots>7&&e.dataObj.windSpeedKnots<10?(n="ים סביר, למתחילים עם לונג",p.attr("src","/public/assets/img/longboardWave.jpg")):(n="לא מומלץ, גל נמוך ורוח יחסית חזקה",p.attr("src","/public/assets/img/lowCrappyWaves.jpg")):(n="ים לחסקה",p.attr("src","/public/assets/img/hasake.jpg")),s.find("h1").text(n),s.find("p").text(t+" "+a+"\n"+i),d.parent().fadeIn(600),$("#"+e.name+" i").hide()};!function(){webApp.communication.http("/api/"+e.name,"GET").then(function(d){e.dataObj=d.data,a(),t()})}()},webApp.Graph=function(a){var t=function(a){var t=[];if(!a||0===a.length)return[];for(var e=0;e<a.length;e+=1)t.push(parseFloat(a[e]));return t};$(webApp.idAndClassesMap[a+"Chart"]).highcharts({chart:{type:"areaspline",backgroundColor:"rgba(255, 255, 255, 0)"},title:{text:(webApp.charts[a+"Data"].data.date||"")+"  "+webApp.charts[a+"Data"].title,style:{color:"black",fontFamily:"monospace"}},legend:{color:"black",itemStyle:{color:"black",fontFamily:"monospace"}},xAxis:{categories:webApp.charts[a+"Data"].data.time||[],labels:{style:{color:"black",fontFamily:"monospace"}},lineWidth:0,minorGridLineWidth:0,lineColor:"transparent",minorTickLength:0,tickLength:0},yAxis:{gridLineColor:"white",title:{text:"Height[meter]",style:{color:"black",fontFamily:"monospace"}},labels:{style:{color:"black",fontFamily:"monospace"}}},tooltip:{shared:!0,valueSuffix:" meter"},credits:{enabled:!1},plotOptions:{areaspline:{fillOpacity:.5}},series:[{color:"rgba(0, 0, 0, 0.95)",name:"גל מקסימלי",data:t(webApp.charts[a+"Data"].data.hMax)||[]},{name:"גל מינימלי",data:t(webApp.charts[a+"Data"].data.hS)||[]}]})},webApp.Main=function(){},webApp.Main.prototype.getData=function(a){return webApp.communication.http(a,"GET")},webApp.Main.prototype.setCity=function(a){var t=$(webApp.idAndClassesMap[a+"Status"]+" .height"),e=$(webApp.idAndClassesMap[a+"Status"]+" .date"),d=$(webApp.idAndClassesMap[a+"Status"]+" .hour"),n=$(webApp.idAndClassesMap[a+"Status"]+" .temp");t.text(webApp.charts[a+"Data"].data.hS[webApp.charts[a+"Data"].data.hS.length-1]+"m - "+webApp.charts[a+"Data"].data.hMax[webApp.charts[a+"Data"].data.hMax.length-1]+"m"),e.text(webApp.charts[a+"Data"].data.date),d.text(webApp.charts[a+"Data"].data.time[webApp.charts[a+"Data"].data.time.length-1]),n.html(webApp.charts[a+"Data"].data.temperature[webApp.charts[a+"Data"].data.temperature.length-1]+"&deg")},webApp.communication={http:function(a,t){var e=$.Deferred();return $.ajax({url:a,crossDomain:!0,type:t,success:function(a){e.resolve(a)}}),e.promise()}},webApp.getTime=function(a){var t=function(a){return 10>a&&(a="0"+a),a},e=new Date(a),d=t(e.getHours()),n=t(e.getMinutes());return d+":"+n},webApp.formatDate=function(a){var t=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],e=new Date(a);return t[e.getUTCMonth()]+" "+e.getUTCDate()};